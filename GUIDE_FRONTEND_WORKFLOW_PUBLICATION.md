# üìö Guide Frontend - Les 2 Workflows de Publication

> **Date** : D√©cembre 2024  
> **Version** : 1.0  
> **Public** : √âquipe Frontend

## üéØ Vue d'ensemble

PrintAlma propose **2 workflows de publication** pour les vendeurs :

1. **üì§ Publication Automatique** : Le produit est publi√© d√®s validation du design
2. **üìù Publication Manuelle** : Le produit reste en brouillon apr√®s validation

---

## üîÑ Workflow 1 : Publication Automatique

### üìã Caract√©ristiques
- **Choix vendeur** : "Publier automatiquement"
- **Backend** : `forcedStatus: "PENDING"`
- **Publication** : Automatique apr√®s validation admin

### üé¨ √âtapes

1. **Cr√©ation Produit**
   ```typescript
   // Frontend envoie
   {
     forcedStatus: "PENDING",
     // ... autres donn√©es
   }
   
   // Backend r√©pond
   {
     status: "DRAFT",
     forcedStatus: "PENDING",
     isValidated: false
   }
   ```

2. **Soumission Design**
   ```typescript
   // Backend met √† jour
   {
     status: "PENDING",
     forcedStatus: "PENDING",
     isValidated: false
   }
   ```

3. **Validation Admin**
   ```typescript
   // Backend publie automatiquement
   {
     status: "PUBLISHED",
     forcedStatus: "PENDING",
     isValidated: true,
     publishedAt: "2024-12-01T10:00:00Z"
   }
   ```

### üé® Interface

```tsx
// Affichage selon l'√©tat
const AutoPublishDisplay = ({ product }) => {
  if (product.status === 'PUBLISHED') {
    return (
      <div className="product-status">
        <span className="badge success">üöÄ Publi√©</span>
        <span className="workflow-type">Publication automatique</span>
      </div>
    );
  }

  if (product.status === 'PENDING') {
    return (
      <div className="product-status">
        <span className="badge warning">‚è≥ En attente</span>
        <span className="workflow-type">Publication auto apr√®s validation</span>
      </div>
    );
  }

  return (
    <div className="product-status">
      <span className="badge info">üìù En cours</span>
      <span className="workflow-type">Publication auto activ√©e</span>
    </div>
  );
};
```

---

## üîÑ Workflow 2 : Publication Manuelle (Brouillon)

### üìã Caract√©ristiques
- **Choix vendeur** : "Mettre en brouillon"
- **Backend** : `forcedStatus: "DRAFT"`
- **Publication** : Manuelle apr√®s validation admin

### üé¨ √âtapes

1. **Cr√©ation Produit**
   ```typescript
   // Frontend envoie
   {
     forcedStatus: "DRAFT",
     // ... autres donn√©es
   }
   
   // Backend r√©pond
   {
     status: "DRAFT",
     forcedStatus: "DRAFT",
     isValidated: false
   }
   ```

2. **Soumission Design**
   ```typescript
   // Backend garde en brouillon
   {
     status: "DRAFT",
     forcedStatus: "DRAFT",
     isValidated: false
   }
   ```

3. **Validation Admin**
   ```typescript
   // Backend valide mais garde en brouillon
   {
     status: "DRAFT",
     forcedStatus: "DRAFT",
     isValidated: true
   }
   ```

4. **Publication Manuelle**
   ```typescript
   // Endpoint √† appeler
   POST /api/vendor-products/{id}/publish
   
   // Backend publie
   {
     status: "PUBLISHED",
     forcedStatus: "DRAFT",
     isValidated: true,
     publishedAt: "2024-12-01T10:00:00Z"
   }
   ```

### üé® Interface

```tsx
// Affichage selon l'√©tat
const ManualPublishDisplay = ({ product }) => {
  const canPublish = (
    product.forcedStatus === 'DRAFT' &&
    product.status === 'DRAFT' &&
    product.isValidated === true
  );

  return (
    <div className="product-status">
      {product.status === 'PUBLISHED' ? (
        <>
          <span className="badge success">üöÄ Publi√©</span>
          <span className="workflow-type">Publication manuelle</span>
        </>
      ) : (
        <>
          <span className="badge draft">üìù Brouillon</span>
          <span className="workflow-type">Publication manuelle</span>
          {canPublish && (
            <button 
              className="btn-publish"
              onClick={() => publishProduct(product.id)}
            >
              üì§ Publier maintenant
            </button>
          )}
        </>
      )}
    </div>
  );
};
```

---

## üé® Composant de Choix Workflow

```tsx
const PublicationWorkflowChoice = ({ onChange }) => {
  const [workflowType, setWorkflowType] = useState('auto-publish');

  const handleChange = (type) => {
    setWorkflowType(type);
    onChange(type === 'auto-publish' ? 'PENDING' : 'DRAFT');
  };

  return (
    <div className="workflow-choice">
      <h3>üì§ Choix de publication</h3>
      
      <div className="choice-container">
        <label className="choice-card">
          <input
            type="radio"
            name="workflow"
            value="auto-publish"
            checked={workflowType === 'auto-publish'}
            onChange={() => handleChange('auto-publish')}
          />
          <div className="choice-content">
            <h4>üöÄ Publication Automatique</h4>
            <p>Publi√© d√®s validation du design par l'admin</p>
            <ul>
              <li>‚úÖ Plus rapide</li>
              <li>‚úÖ Pas d'action suppl√©mentaire</li>
              <li>‚ùå Moins de contr√¥le</li>
            </ul>
          </div>
        </label>

        <label className="choice-card">
          <input
            type="radio"
            name="workflow"
            value="manual-publish"
            checked={workflowType === 'manual-publish'}
            onChange={() => handleChange('manual-publish')}
          />
          <div className="choice-content">
            <h4>üìù Brouillon</h4>
            <p>Reste en brouillon apr√®s validation</p>
            <ul>
              <li>‚úÖ Plus de contr√¥le</li>
              <li>‚úÖ Publication quand vous voulez</li>
              <li>‚ùå Action manuelle requise</li>
            </ul>
          </div>
        </label>
      </div>
    </div>
  );
};
```

---

## üéØ Logique de D√©tection

```typescript
interface Product {
  status: 'PUBLISHED' | 'PENDING' | 'DRAFT';
  forcedStatus: 'PENDING' | 'DRAFT';
  isValidated: boolean;
}

function getProductState(product: Product) {
  // 1. Publication Automatique
  if (product.forcedStatus === 'PENDING') {
    if (product.status === 'PUBLISHED') {
      return {
        badge: 'üöÄ Publi√©',
        message: 'Publication automatique effectu√©e',
        canPublish: false
      };
    }
    if (product.status === 'PENDING') {
      return {
        badge: '‚è≥ En attente',
        message: 'Publication apr√®s validation admin',
        canPublish: false
      };
    }
    return {
      badge: 'üìù En cours',
      message: 'Publication auto activ√©e',
      canPublish: false
    };
  }

  // 2. Publication Manuelle
  if (product.status === 'PUBLISHED') {
    return {
      badge: 'üöÄ Publi√©',
      message: 'Publication manuelle effectu√©e',
      canPublish: false
    };
  }
  
  const canPublish = (
    product.status === 'DRAFT' &&
    product.isValidated === true
  );

  return {
    badge: 'üìù Brouillon',
    message: canPublish 
      ? 'Pr√™t √† publier' 
      : 'En attente de validation',
    canPublish
  };
}
```

---

## üö® Points Importants

### 1Ô∏è‚É£ Choix Initial
- Le choix du workflow est **d√©finitif**
- `forcedStatus` ne change **jamais**
- Bien expliquer les diff√©rences aux vendeurs

### 2Ô∏è‚É£ √âtats Possibles
```typescript
type WorkflowState = {
  forcedStatus: 'PENDING' | 'DRAFT';    // Intention initiale
  status: 'PUBLISHED' | 'PENDING' | 'DRAFT';  // √âtat actuel
  isValidated: boolean;                 // Validation design
};
```

### 3Ô∏è‚É£ Transitions
- **Auto-Publish** : `DRAFT ‚Üí PENDING ‚Üí PUBLISHED`
- **Manual-Publish** : `DRAFT ‚Üí DRAFT(valid√©) ‚Üí PUBLISHED`

### 4Ô∏è‚É£ Bouton "Publier"
- Visible **uniquement** si :
  ```typescript
  product.forcedStatus === 'DRAFT' &&
  product.status === 'DRAFT' &&
  product.isValidated === true
  ```

---

## üé® Style Recommand√©

```scss
.workflow-choice {
  .choice-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin: 20px 0;
  }

  .choice-card {
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 20px;
    cursor: pointer;
    transition: all 0.3s;

    &:hover {
      border-color: #007bff;
      background: #f8f9fa;
    }

    input[type="radio"] {
      margin-right: 10px;
    }

    h4 {
      margin: 0 0 10px;
      color: #333;
    }

    p {
      color: #666;
      margin-bottom: 15px;
    }

    ul {
      list-style: none;
      padding: 0;
      margin: 0;

      li {
        margin: 5px 0;
        font-size: 14px;
      }
    }
  }
}

.product-status {
  .badge {
    display: inline-block;
    padding: 4px 12px;
    border-radius: 16px;
    font-size: 12px;
    font-weight: bold;
    margin-right: 10px;

    &.success { 
      background: #d4edda;
      color: #155724;
    }
    
    &.warning {
      background: #fff3cd;
      color: #856404;
    }
    
    &.draft {
      background: #f8f9fa;
      color: #6c757d;
      border: 1px dashed #6c757d;
    }
  }

  .workflow-type {
    font-size: 14px;
    color: #6c757d;
  }

  .btn-publish {
    margin-top: 10px;
    background: #28a745;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;

    &:hover {
      background: #218838;
    }

    &:disabled {
      background: #6c757d;
      cursor: not-allowed;
    }
  }
}
```

---

## üìã Checklist Impl√©mentation

### ‚úÖ Cr√©ation Produit
- [ ] Composant choix workflow
- [ ] Validation choix obligatoire
- [ ] Envoi `forcedStatus` correct

### ‚úÖ Liste Produits
- [ ] Affichage √©tat correct
- [ ] Badge dynamique
- [ ] Message explicatif
- [ ] Bouton publication conditionnel

### ‚úÖ Publication
- [ ] Service `publishProduct()`
- [ ] Gestion loading/error
- [ ] Toast notifications
- [ ] Refresh apr√®s succ√®s

---

## üéØ R√©sultat Final

Les vendeurs doivent avoir :

1. **Choix clair** au moment de la cr√©ation
2. **Visibilit√© parfaite** de l'√©tat de leurs produits
3. **Actions √©videntes** quand publication possible
4. **Feedback imm√©diat** √† chaque action

**Le backend est pr√™t - Impl√©mentez une UX parfaite !** üöÄ 