# üìã Guide Frontend - Commandes Vendeur en Lecture Seule

## üéØ Objectif
Les vendeurs ne peuvent plus modifier le statut des commandes. Seuls les **admins** peuvent g√©rer les √©tats d'avancement. Les vendeurs ont maintenant un acc√®s **lecture seule** pour visualiser leurs commandes.

## üö´ Changements Backend Effectu√©s

### Endpoints SUPPRIM√âS pour les vendeurs :
- ‚ùå `PATCH /vendor/orders/:orderId/status` - Mise √† jour du statut

### Endpoints CONSERV√âS pour les vendeurs (lecture seule) :
- ‚úÖ `GET /vendor/orders` - Liste des commandes
- ‚úÖ `GET /vendor/orders/:orderId` - D√©tails d'une commande
- ‚úÖ `GET /vendor/orders/statistics` - Statistiques
- ‚úÖ `GET /vendor/orders/search` - Recherche
- ‚úÖ `GET /vendor/orders/status/:status` - Filtrer par statut
- ‚úÖ `GET /vendor/orders/export/csv` - Export CSV
- ‚úÖ `GET /vendor/orders/notifications` - Notifications
- ‚úÖ `PATCH /vendor/orders/notifications/:id/read` - Marquer notification lue

### Endpoints ADMIN pour la gestion des commandes :
- ‚úÖ `PATCH /orders/:id/status` - Mise √† jour du statut (ADMIN/SUPERADMIN uniquement)

## üõ†Ô∏è Modifications Frontend Requises

### 1. Interface Vendeur - Suppression des Actions de Modification

#### A. Page de Liste des Commandes (`VendorOrdersList.tsx`)

**AVANT (√† supprimer) :**
```tsx
// ‚ùå Supprimer ces boutons d'action
<Button
  onClick={() => updateOrderStatus(order.id, 'CONFIRMED')}
  variant="success"
>
  Confirmer
</Button>

<Button
  onClick={() => updateOrderStatus(order.id, 'PROCESSING')}
  variant="warning"
>
  En traitement
</Button>

<Button
  onClick={() => updateOrderStatus(order.id, 'SHIPPED')}
  variant="info"
>
  Exp√©dier
</Button>
```

**APR√àS (lecture seule) :**
```tsx
// ‚úÖ Remplacer par des badges de statut uniquement
<Badge
  variant={getStatusVariant(order.status)}
  className="status-badge"
>
  {getStatusLabel(order.status)}
</Badge>

// ‚úÖ Fonction helper pour les couleurs
const getStatusVariant = (status: string) => {
  switch (status) {
    case 'PENDING': return 'warning';
    case 'CONFIRMED': return 'info';
    case 'PROCESSING': return 'primary';
    case 'SHIPPED': return 'success';
    case 'DELIVERED': return 'success';
    case 'CANCELLED': return 'danger';
    case 'REJECTED': return 'danger';
    default: return 'secondary';
  }
};

const getStatusLabel = (status: string) => {
  const labels = {
    PENDING: 'En attente',
    CONFIRMED: 'Confirm√©e',
    PROCESSING: 'En traitement',
    SHIPPED: 'Exp√©di√©e',
    DELIVERED: 'Livr√©e',
    CANCELLED: 'Annul√©e',
    REJECTED: 'Rejet√©e'
  };
  return labels[status] || status;
};
```

#### B. Page de D√©tails de Commande (`VendorOrderDetails.tsx`)

**AVANT (√† supprimer) :**
```tsx
// ‚ùå Supprimer toute la section d'actions
<div className="order-actions">
  <h4>Actions sur la commande</h4>
  <div className="action-buttons">
    <Button onClick={() => handleStatusUpdate('CONFIRMED')}>
      Confirmer la commande
    </Button>
    <Button onClick={() => handleStatusUpdate('PROCESSING')}>
      Mettre en traitement
    </Button>
    <Button onClick={() => handleStatusUpdate('SHIPPED')}>
      Marquer comme exp√©di√©e
    </Button>
  </div>
</div>

// ‚ùå Supprimer les formulaires de mise √† jour
<form onSubmit={handleStatusUpdate}>
  <select name="status" value={selectedStatus}>
    <option value="CONFIRMED">Confirm√©e</option>
    <option value="PROCESSING">En traitement</option>
    <option value="SHIPPED">Exp√©di√©e</option>
  </select>
  <button type="submit">Mettre √† jour</button>
</form>
```

**APR√àS (lecture seule) :**
```tsx
// ‚úÖ Remplacer par un timeline de suivi
<div className="order-timeline">
  <h4>Suivi de la commande</h4>
  <div className="timeline">
    <div className={`timeline-item ${isStatusReached('PENDING') ? 'completed' : ''}`}>
      <div className="timeline-marker"></div>
      <div className="timeline-content">
        <h5>Commande re√ßue</h5>
        <p>{order.createdAt}</p>
      </div>
    </div>

    <div className={`timeline-item ${isStatusReached('CONFIRMED') ? 'completed' : ''}`}>
      <div className="timeline-marker"></div>
      <div className="timeline-content">
        <h5>Commande confirm√©e</h5>
        <p>{order.confirmedAt || 'En attente de confirmation par l\'admin'}</p>
      </div>
    </div>

    <div className={`timeline-item ${isStatusReached('PROCESSING') ? 'completed' : ''}`}>
      <div className="timeline-marker"></div>
      <div className="timeline-content">
        <h5>En traitement</h5>
        <p>{order.processingAt || 'Non d√©marr√©'}</p>
      </div>
    </div>

    <div className={`timeline-item ${isStatusReached('SHIPPED') ? 'completed' : ''}`}>
      <div className="timeline-marker"></div>
      <div className="timeline-content">
        <h5>Exp√©di√©e</h5>
        <p>{order.shippedAt || 'Non exp√©di√©e'}</p>
      </div>
    </div>

    <div className={`timeline-item ${isStatusReached('DELIVERED') ? 'completed' : ''}`}>
      <div className="timeline-marker"></div>
      <div className="timeline-content">
        <h5>Livr√©e</h5>
        <p>{order.deliveredAt || 'Non livr√©e'}</p>
      </div>
    </div>
  </div>
</div>

// ‚úÖ Fonction helper pour v√©rifier si un statut est atteint
const isStatusReached = (targetStatus: string): boolean => {
  const statusOrder = ['PENDING', 'CONFIRMED', 'PROCESSING', 'SHIPPED', 'DELIVERED'];
  const currentIndex = statusOrder.indexOf(order.status);
  const targetIndex = statusOrder.indexOf(targetStatus);
  return currentIndex >= targetIndex;
};
```

### 2. Services Frontend - Nettoyage des M√©thodes

#### A. VendorOrderService (`vendorOrderService.ts`)

**AVANT (√† supprimer) :**
```typescript
// ‚ùå Supprimer cette m√©thode
export const updateOrderStatus = async (orderId: number, status: string, notes?: string) => {
  try {
    const response = await api.patch(`/vendor/orders/${orderId}/status`, {
      status,
      notes
    });
    return response.data;
  } catch (error) {
    throw new Error(error.response?.data?.message || 'Erreur lors de la mise √† jour');
  }
};

// ‚ùå Supprimer ces m√©thodes aussi
export const confirmOrder = async (orderId: number) => {
  return updateOrderStatus(orderId, 'CONFIRMED');
};

export const startProcessing = async (orderId: number) => {
  return updateOrderStatus(orderId, 'PROCESSING');
};

export const shipOrder = async (orderId: number) => {
  return updateOrderStatus(orderId, 'SHIPPED');
};
```

**APR√àS (conserver uniquement la lecture) :**
```typescript
// ‚úÖ Conserver ces m√©thodes de lecture
export const getVendorOrders = async (filters?: VendorOrderFilters) => {
  try {
    const params = new URLSearchParams();
    if (filters?.page) params.append('page', filters.page.toString());
    if (filters?.limit) params.append('limit', filters.limit.toString());
    if (filters?.status) params.append('status', filters.status);
    if (filters?.search) params.append('search', filters.search);

    const response = await api.get(`/vendor/orders?${params.toString()}`);
    return response.data;
  } catch (error) {
    throw new Error(error.response?.data?.message || 'Erreur lors de la r√©cup√©ration');
  }
};

export const getOrderDetails = async (orderId: number) => {
  try {
    const response = await api.get(`/vendor/orders/${orderId}`);
    return response.data;
  } catch (error) {
    throw new Error(error.response?.data?.message || 'Erreur lors de la r√©cup√©ration');
  }
};

export const getVendorStatistics = async () => {
  try {
    const response = await api.get('/vendor/orders/statistics');
    return response.data;
  } catch (error) {
    throw new Error(error.response?.data?.message || 'Erreur lors de la r√©cup√©ration');
  }
};

export const exportOrdersCSV = async (filters?: VendorOrderFilters) => {
  try {
    const params = new URLSearchParams();
    if (filters?.startDate) params.append('startDate', filters.startDate);
    if (filters?.endDate) params.append('endDate', filters.endDate);
    if (filters?.status) params.append('status', filters.status);

    const response = await api.get(`/vendor/orders/export/csv?${params.toString()}`, {
      responseType: 'blob'
    });

    // T√©l√©charger le fichier
    const url = window.URL.createObjectURL(new Blob([response.data]));
    const link = document.createElement('a');
    link.href = url;
    link.setAttribute('download', 'vendor-orders.csv');
    document.body.appendChild(link);
    link.click();
    link.remove();

    return response.data;
  } catch (error) {
    throw new Error(error.response?.data?.message || 'Erreur lors de l\'export');
  }
};
```

### 3. Interface Admin - Gestion des Commandes

#### A. AdminOrderDetails (`AdminOrderDetails.tsx`)

```tsx
// ‚úÖ Interface admin pour g√©rer les statuts
import React, { useState } from 'react';
import { updateOrderStatusAdmin } from '../services/adminOrderService';

const AdminOrderDetails = ({ orderId }) => {
  const [selectedStatus, setSelectedStatus] = useState('');
  const [adminNote, setAdminNote] = useState('');
  const [loading, setLoading] = useState(false);

  const handleStatusUpdate = async (e) => {
    e.preventDefault();
    setLoading(true);

    try {
      await updateOrderStatusAdmin(orderId, {
        status: selectedStatus,
        adminNote: adminNote
      });

      // Rafra√Æchir les donn√©es
      window.location.reload(); // ou utiliser un state management

      toast.success('Statut mis √† jour avec succ√®s');
    } catch (error) {
      toast.error(error.message);
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="admin-order-management">
      <h4>Gestion de la commande (Admin)</h4>

      <form onSubmit={handleStatusUpdate} className="status-update-form">
        <div className="form-group">
          <label>Nouveau statut :</label>
          <select
            value={selectedStatus}
            onChange={(e) => setSelectedStatus(e.target.value)}
            required
          >
            <option value="">S√©lectionner un statut</option>
            <option value="PENDING">En attente</option>
            <option value="CONFIRMED">Confirm√©e</option>
            <option value="PROCESSING">En traitement</option>
            <option value="SHIPPED">Exp√©di√©e</option>
            <option value="DELIVERED">Livr√©e</option>
            <option value="CANCELLED">Annul√©e</option>
            <option value="REJECTED">Rejet√©e</option>
          </select>
        </div>

        <div className="form-group">
          <label>Note admin (optionnel) :</label>
          <textarea
            value={adminNote}
            onChange={(e) => setAdminNote(e.target.value)}
            placeholder="Ajouter une note..."
            rows={3}
          />
        </div>

        <button
          type="submit"
          disabled={!selectedStatus || loading}
          className="btn btn-primary"
        >
          {loading ? 'Mise √† jour...' : 'Mettre √† jour le statut'}
        </button>
      </form>
    </div>
  );
};
```

#### B. AdminOrderService (`adminOrderService.ts`)

```typescript
// ‚úÖ Service admin pour g√©rer les commandes
import api from './api';

export const updateOrderStatusAdmin = async (orderId: number, updateData: {
  status: string;
  adminNote?: string;
}) => {
  try {
    const response = await api.patch(`/orders/${orderId}/status`, updateData);
    return response.data;
  } catch (error) {
    throw new Error(error.response?.data?.message || 'Erreur lors de la mise √† jour');
  }
};

export const getAllOrders = async (filters?: {
  page?: number;
  limit?: number;
  status?: string;
  vendorId?: number;
}) => {
  try {
    const params = new URLSearchParams();
    if (filters?.page) params.append('page', filters.page.toString());
    if (filters?.limit) params.append('limit', filters.limit.toString());
    if (filters?.status) params.append('status', filters.status);
    if (filters?.vendorId) params.append('vendorId', filters.vendorId.toString());

    const response = await api.get(`/orders/admin/all?${params.toString()}`);
    return response.data;
  } catch (error) {
    throw new Error(error.response?.data?.message || 'Erreur lors de la r√©cup√©ration');
  }
};
```

## üé® CSS pour l'Interface de Suivi

```css
/* ‚úÖ Styles pour le timeline de suivi */
.order-timeline {
  margin: 20px 0;
}

.timeline {
  position: relative;
  padding-left: 30px;
}

.timeline::before {
  content: '';
  position: absolute;
  left: 15px;
  top: 0;
  bottom: 0;
  width: 2px;
  background: #e9ecef;
}

.timeline-item {
  position: relative;
  margin-bottom: 20px;
}

.timeline-marker {
  position: absolute;
  left: -23px;
  top: 5px;
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: #e9ecef;
  border: 2px solid #fff;
  box-shadow: 0 0 0 2px #e9ecef;
}

.timeline-item.completed .timeline-marker {
  background: #28a745;
  box-shadow: 0 0 0 2px #28a745;
}

.timeline-content h5 {
  margin: 0 0 5px 0;
  font-weight: 600;
}

.timeline-content p {
  margin: 0;
  color: #6c757d;
  font-size: 14px;
}

.timeline-item.completed .timeline-content h5 {
  color: #28a745;
}

/* ‚úÖ Styles pour les badges de statut */
.status-badge {
  font-size: 12px;
  font-weight: 600;
  padding: 4px 8px;
  border-radius: 4px;
}

/* ‚úÖ Styles pour l'interface admin */
.admin-order-management {
  background: #f8f9fa;
  padding: 20px;
  border-radius: 8px;
  margin: 20px 0;
  border-left: 4px solid #007bff;
}

.status-update-form .form-group {
  margin-bottom: 15px;
}

.status-update-form label {
  display: block;
  margin-bottom: 5px;
  font-weight: 600;
}

.status-update-form select,
.status-update-form textarea {
  width: 100%;
  padding: 8px 12px;
  border: 1px solid #ddd;
  border-radius: 4px;
}
```

## üìù Messages d'Information pour les Vendeurs

```tsx
// ‚úÖ Ajouter un message informatif pour les vendeurs
const VendorOrderInfo = () => (
  <div className="alert alert-info" role="alert">
    <h5>üìã Information importante</h5>
    <p>
      Vous pouvez maintenant <strong>consulter</strong> vos commandes et suivre leur progression,
      mais seuls les <strong>administrateurs</strong> peuvent modifier les statuts des commandes.
    </p>
    <p className="mb-0">
      Pour toute question sur le statut d'une commande, contactez l'√©quipe administrative.
    </p>
  </div>
);
```

## üîß Checklist de Migration

### √Ä Faire :

- [ ] Supprimer tous les boutons de modification de statut dans l'interface vendeur
- [ ] Remplacer par des badges de statut en lecture seule
- [ ] Impl√©menter le timeline de suivi des commandes
- [ ] Supprimer les m√©thodes `updateOrderStatus` du service vendeur
- [ ] Cr√©er l'interface admin pour la gestion des statuts
- [ ] Impl√©menter le service admin pour les mises √† jour
- [ ] Ajouter les messages informatifs pour les vendeurs
- [ ] Tester que les vendeurs ne peuvent plus modifier les statuts
- [ ] Tester que les admins peuvent modifier les statuts
- [ ] Mettre √† jour les tests frontend

### Points d'Attention :

1. **Gestion d'erreurs** : Assurez-vous que l'interface g√®re correctement les erreurs 403 (Forbidden)
2. **Cache** : Videz le cache des donn√©es de commandes apr√®s la migration
3. **Notifications** : Les vendeurs doivent √™tre notifi√©s des changements de statut par les admins
4. **Responsive** : Assurez-vous que le nouveau timeline fonctionne sur mobile

## üöÄ R√©sultat Final

- ‚úÖ **Vendeurs** : Interface claire de suivi en lecture seule
- ‚úÖ **Admins** : Contr√¥le total sur la gestion des commandes
- ‚úÖ **UX am√©lior√©e** : Timeline visuel pour le suivi des commandes
- ‚úÖ **S√©curit√©** : Permissions strictement appliqu√©es

Cette migration am√©liore la s√©paration des responsabilit√©s et donne un meilleur contr√¥le administratif sur le processus de commande.