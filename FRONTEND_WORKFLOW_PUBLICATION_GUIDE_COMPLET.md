# üéØ Guide Frontend - Workflow Publication Complet

> **Date** : D√©cembre 2024  
> **Status** : Backend corrig√© - Impl√©mentation frontend requise  
> **Priorit√©** : Critique pour UX vendeur

---

## üìã Vue d'ensemble

Le backend supporte maintenant **2 workflows de publication distincts** bas√©s sur le choix initial du vendeur lors de la cr√©ation du produit.

### üîÑ Les 2 Workflows

| Workflow | Choix vendeur | Backend `forcedStatus` | Comportement |
|----------|---------------|------------------------|--------------|
| **AUTO-PUBLISH** | "Publier automatiquement" | `PENDING` | Publication imm√©diate apr√®s validation design |
| **MANUAL-PUBLISH** | "Mettre en brouillon" | `DRAFT` | Validation design ‚Üí brouillon valid√© ‚Üí clic vendeur requis |

---

## üé® Interface Utilisateur Requise

### 1Ô∏è‚É£ √âcran Cr√©ation Produit

**Choix obligatoire avec 2 options radio :**

```jsx
<div className="publication-choice">
  <h3>Workflow de publication</h3>
  
  <label>
    <input 
      type="radio" 
      name="publicationWorkflow" 
      value="auto-publish"
      checked={workflowType === 'auto-publish'}
      onChange={() => setWorkflowType('auto-publish')}
    />
    <strong>üì§ Publication automatique</strong>
    <p>Le produit sera publi√© imm√©diatement apr√®s validation du design par l'admin</p>
  </label>
  
  <label>
    <input 
      type="radio" 
      name="publicationWorkflow" 
      value="manual-publish"
      checked={workflowType === 'manual-publish'}
      onChange={() => setWorkflowType('manual-publish')}
    />
    <strong>üìù Mettre en brouillon</strong>
    <p>Le produit restera en brouillon apr√®s validation. Vous pourrez le publier quand vous voulez</p>
  </label>
</div>
```

### 2Ô∏è‚É£ Envoi vers Backend

```tsx
// Mapper le choix frontend vers le backend
const mapWorkflowToForcedStatus = (workflow: string): 'PENDING' | 'DRAFT' => {
  return workflow === 'auto-publish' ? 'PENDING' : 'DRAFT';
};

// Dans la requ√™te de cr√©ation
const createProductPayload = {
  // ... autres donn√©es ...
  forcedStatus: mapWorkflowToForcedStatus(workflowType),
  // ... autres donn√©es ...
};
```

---

## üìä Affichage Liste Produits

### üîç Logique de d√©tection workflow

```tsx
interface ProductDisplayLogic {
  status: 'PUBLISHED' | 'PENDING' | 'DRAFT';
  forcedStatus: 'PENDING' | 'DRAFT';
  isValidated: boolean;
  designValidationStatus: 'PENDING' | 'VALIDATED' | 'REJECTED';
}

const getProductDisplay = (product: ProductDisplayLogic) => {
  // 1Ô∏è‚É£ D√©terminer le workflow original
  const workflowType = product.forcedStatus === 'PENDING' ? 'AUTO_PUBLISH' : 'MANUAL_PUBLISH';
  
  // 2Ô∏è‚É£ Status badge affich√©
  const displayStatus = product.status; // PUBLISHED, PENDING, ou DRAFT
  
  // 3Ô∏è‚É£ Bouton "Publier maintenant" visible
  const showPublishButton = (
    product.forcedStatus === 'DRAFT' && 
    product.isValidated === true &&
    product.status === 'DRAFT'
  );
  
  // 4Ô∏è‚É£ Message workflow
  const workflowMessage = workflowType === 'AUTO_PUBLISH' 
    ? "Workflow AUTO-PUBLISH activ√©" 
    : "Workflow MANUEL - Clic requis pour publier";
    
  return {
    workflowType,
    displayStatus,
    showPublishButton,
    workflowMessage
  };
};
```

### üé® Composant Produit

```tsx
const ProductCard = ({ product }) => {
  const display = getProductDisplay(product);
  
  return (
    <div className="product-card">
      {/* Status Badge */}
      <div className={`status-badge status-${display.displayStatus.toLowerCase()}`}>
        {display.displayStatus === 'PUBLISHED' && 'üöÄ Publi√©'}
        {display.displayStatus === 'PENDING' && '‚è≥ En attente'}
        {display.displayStatus === 'DRAFT' && 'üìù Brouillon'}
      </div>
      
      {/* Workflow Indicator */}
      <div className="workflow-info">
        <span className={`workflow-type ${display.workflowType.toLowerCase()}`}>
          {display.workflowMessage}
        </span>
        
        {/* Validation Status */}
        {product.designValidationStatus === 'PENDING' && (
          <span className="validation-pending">üîç Design en cours de validation</span>
        )}
        {product.designValidationStatus === 'VALIDATED' && (
          <span className="validation-success">‚úÖ Design valid√©</span>
        )}
        {product.designValidationStatus === 'REJECTED' && (
          <span className="validation-rejected">‚ùå Design rejet√©</span>
        )}
      </div>
      
      {/* Actions */}
      <div className="product-actions">
        {display.showPublishButton && (
          <button 
            className="btn-publish-now"
            onClick={() => publishProduct(product.id)}
          >
            üì§ Publier maintenant
          </button>
        )}
        
        <button className="btn-edit">‚úèÔ∏è Modifier</button>
        <button className="btn-delete">üóëÔ∏è Supprimer</button>
      </div>
    </div>
  );
};
```

---

## üéØ Sc√©narios d'Usage D√©taill√©s

### üì§ Scenario AUTO-PUBLISH

**1. Cr√©ation produit**
- Vendeur choisit "Publication automatique"
- Frontend envoie `forcedStatus: "PENDING"`
- Backend : `status: DRAFT`, `forcedStatus: PENDING`

**2. Soumission validation**
- Backend : `status: PENDING`, `forcedStatus: PENDING`
- Frontend affiche : "Status: PENDING | Workflow AUTO-PUBLISH | Bouton: Cach√©"

**3. Admin valide design**
- Backend : `status: PUBLISHED`, `forcedStatus: PENDING`, `isValidated: true`
- Frontend affiche : "Status: PUBLISHED | Workflow AUTO-PUBLISH | Bouton: Cach√©"

### üìù Scenario MANUAL-PUBLISH

**1. Cr√©ation produit**
- Vendeur choisit "Mettre en brouillon"
- Frontend envoie `forcedStatus: "DRAFT"`
- Backend : `status: DRAFT`, `forcedStatus: DRAFT`

**2. Soumission validation**
- Backend : `status: DRAFT`, `forcedStatus: DRAFT` (inchang√© !)
- Frontend affiche : "Status: DRAFT | Workflow MANUEL | Bouton: Cach√©"

**3. Admin valide design**
- Backend : `status: DRAFT`, `forcedStatus: DRAFT`, `isValidated: true`
- Frontend affiche : "Status: DRAFT | Workflow MANUEL | Bouton: VISIBLE"

**4. Vendeur clique "Publier"**
- Frontend appelle endpoint de publication manuelle
- Backend : `status: PUBLISHED`
- Frontend affiche : "Status: PUBLISHED | Workflow MANUEL | Bouton: Cach√©"

---

## üîß Endpoints Backend √† Utiliser

### üì§ Publication manuelle (nouveau endpoint requis)

```typescript
// Endpoint pour publication manuelle des brouillons valid√©s
POST /api/vendor-products/{id}/publish

// Request body (optionnel)
{}

// Response
{
  "success": true,
  "message": "Produit publi√© avec succ√®s",
  "product": {
    "id": 123,
    "status": "PUBLISHED",
    "forcedStatus": "DRAFT",
    "isValidated": true,
    "publishedAt": "2024-12-01T10:00:00Z"
  }
}
```

### üìä R√©cup√©ration produits

```typescript
// Endpoint existant
GET /api/vendor-products

// Response inclut maintenant forcedStatus
{
  "products": [
    {
      "id": 123,
      "status": "DRAFT",
      "forcedStatus": "DRAFT",  // üÜï NOUVEAU CHAMP
      "isValidated": true,
      "designValidationStatus": "VALIDATED"
    }
  ]
}
```

---

## üé® CSS Recommand√©

```scss
.product-card {
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 16px;
  margin: 8px 0;
  
  .status-badge {
    display: inline-block;
    padding: 4px 12px;
    border-radius: 16px;
    font-size: 12px;
    font-weight: bold;
    margin-bottom: 8px;
    
    &.status-published {
      background: #e7f5e7;
      color: #2d7d2d;
    }
    
    &.status-pending {
      background: #fff3cd;
      color: #856404;
    }
    
    &.status-draft {
      background: #f8f9fa;
      color: #6c757d;
      border: 1px dashed #6c757d;
    }
  }
  
  .workflow-info {
    margin: 8px 0;
    font-size: 14px;
    
    .workflow-type {
      display: block;
      margin-bottom: 4px;
      
      &.auto_publish {
        color: #28a745;
        font-weight: 500;
      }
      
      &.manual_publish {
        color: #6f42c1;
        font-weight: 500;
      }
    }
    
    .validation-pending { color: #ffc107; }
    .validation-success { color: #28a745; }
    .validation-rejected { color: #dc3545; }
  }
  
  .btn-publish-now {
    background: #28a745;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
    font-weight: 500;
    
    &:hover {
      background: #218838;
    }
  }
}

.publication-choice {
  margin: 20px 0;
  padding: 16px;
  border: 1px solid #ddd;
  border-radius: 8px;
  
  label {
    display: block;
    margin: 12px 0;
    padding: 12px;
    border: 1px solid #ddd;
    border-radius: 4px;
    cursor: pointer;
    
    &:hover {
      background: #f8f9fa;
    }
    
    input[type="radio"] {
      margin-right: 8px;
    }
    
    strong {
      display: block;
      margin-bottom: 4px;
    }
    
    p {
      margin: 0;
      font-size: 14px;
      color: #6c757d;
    }
  }
}
```

---

## üìã Checklist Impl√©mentation

### ‚úÖ √âcran Cr√©ation Produit
- [ ] Ajout choix workflow (radio buttons)
- [ ] Mapping `workflowType` ‚Üí `forcedStatus`
- [ ] Envoi `forcedStatus` dans payload cr√©ation
- [ ] Tests cr√©ation avec les 2 workflows

### ‚úÖ Liste Produits
- [ ] Affichage `forcedStatus` re√ßu du backend
- [ ] Logique d√©tection workflow (`getProductDisplay`)
- [ ] Badge status dynamique
- [ ] Message workflow affich√©
- [ ] Bouton "Publier" conditionnel

### ‚úÖ Actions
- [ ] Endpoint publication manuelle impl√©ment√© c√¥t√© backend
- [ ] Fonction `publishProduct()` c√¥t√© frontend
- [ ] Gestion √©tats loading/success/error
- [ ] Refresh liste apr√®s publication

### ‚úÖ Tests
- [ ] Workflow AUTO-PUBLISH complet
- [ ] Workflow MANUAL-PUBLISH complet
- [ ] Edge cases (design rejet√©, etc.)
- [ ] Responsive design

---

## üö® Points Critiques

### ‚ö†Ô∏è Ne pas confondre
- **`status`** = √âtat actuel du produit (PUBLISHED/PENDING/DRAFT)
- **`forcedStatus`** = Intention initiale du vendeur (PENDING=auto / DRAFT=manuel)

### üîí R√®gles de s√©curit√©
- Seuls les produits avec `forcedStatus: DRAFT` + `isValidated: true` peuvent √™tre publi√©s manuellement
- V√©rifier c√¥t√© frontend ET backend avant affichage bouton

### üì± UX Considerations
- Toujours indiquer le workflow choisi initialement
- Message clair quand design en cours de validation
- Feedback imm√©diat lors de la publication manuelle

---

## üéâ R√©sultat Attendu

Apr√®s impl√©mentation, les vendeurs auront :

1. **üéØ Contr√¥le total** sur leurs workflows de publication
2. **üëÄ Visibilit√© claire** de l'√©tat de chaque produit
3. **‚ö° Action rapide** pour publier les brouillons valid√©s
4. **üîÑ Workflow coh√©rent** de bout en bout

**Le backend est pr√™t - √Ä vous de jouer c√¥t√© frontend !** üöÄ 